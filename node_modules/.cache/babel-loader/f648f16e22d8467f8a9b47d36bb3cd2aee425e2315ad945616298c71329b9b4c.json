{"ast":null,"code":"import _classCallCheck from \"/Users/cadany/WebstormProjects/monaco/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/cadany/WebstormProjects/monaco/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _get from \"/Users/cadany/WebstormProjects/monaco/node_modules/@babel/runtime/helpers/esm/get.js\";\nimport _getPrototypeOf from \"/Users/cadany/WebstormProjects/monaco/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js\";\nimport _inherits from \"/Users/cadany/WebstormProjects/monaco/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/cadany/WebstormProjects/monaco/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { Emitter } from '../../../base/common/event.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { LanguagesRegistry } from './languagesRegistry.js';\nimport { firstOrDefault } from '../../../base/common/arrays.js';\nimport { TokenizationRegistry } from '../languages.js';\nimport { PLAINTEXT_LANGUAGE_ID } from '../languages/modesRegistry.js';\nvar LanguageService = /*#__PURE__*/function (_Disposable) {\n  _inherits(LanguageService, _Disposable);\n  var _super = _createSuper(LanguageService);\n  function LanguageService() {\n    var _this;\n    var warnOnOverwrite = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    _classCallCheck(this, LanguageService);\n    _this = _super.call(this);\n    _this._onDidEncounterLanguage = _this._register(new Emitter());\n    _this.onDidEncounterLanguage = _this._onDidEncounterLanguage.event;\n    _this._onDidChange = _this._register(new Emitter({\n      leakWarningThreshold: 200 /* https://github.com/microsoft/vscode/issues/119968 */\n    }));\n    _this.onDidChange = _this._onDidChange.event;\n    LanguageService.instanceCount++;\n    _this._encounteredLanguages = new Set();\n    _this._registry = _this._register(new LanguagesRegistry(true, warnOnOverwrite));\n    _this.languageIdCodec = _this._registry.languageIdCodec;\n    _this._register(_this._registry.onDidChange(function () {\n      return _this._onDidChange.fire();\n    }));\n    return _this;\n  }\n  _createClass(LanguageService, [{\n    key: \"dispose\",\n    value: function dispose() {\n      LanguageService.instanceCount--;\n      _get(_getPrototypeOf(LanguageService.prototype), \"dispose\", this).call(this);\n    }\n  }, {\n    key: \"isRegisteredLanguageId\",\n    value: function isRegisteredLanguageId(languageId) {\n      return this._registry.isRegisteredLanguageId(languageId);\n    }\n  }, {\n    key: \"getLanguageIdByLanguageName\",\n    value: function getLanguageIdByLanguageName(languageName) {\n      return this._registry.getLanguageIdByLanguageName(languageName);\n    }\n  }, {\n    key: \"getLanguageIdByMimeType\",\n    value: function getLanguageIdByMimeType(mimeType) {\n      return this._registry.getLanguageIdByMimeType(mimeType);\n    }\n  }, {\n    key: \"guessLanguageIdByFilepathOrFirstLine\",\n    value: function guessLanguageIdByFilepathOrFirstLine(resource, firstLine) {\n      var languageIds = this._registry.guessLanguageIdByFilepathOrFirstLine(resource, firstLine);\n      return firstOrDefault(languageIds, null);\n    }\n  }, {\n    key: \"createById\",\n    value: function createById(languageId) {\n      var _this2 = this;\n      return new LanguageSelection(this.onDidChange, function () {\n        return _this2._createAndGetLanguageIdentifier(languageId);\n      });\n    }\n  }, {\n    key: \"createByFilepathOrFirstLine\",\n    value: function createByFilepathOrFirstLine(resource, firstLine) {\n      var _this3 = this;\n      return new LanguageSelection(this.onDidChange, function () {\n        var languageId = _this3.guessLanguageIdByFilepathOrFirstLine(resource, firstLine);\n        return _this3._createAndGetLanguageIdentifier(languageId);\n      });\n    }\n  }, {\n    key: \"_createAndGetLanguageIdentifier\",\n    value: function _createAndGetLanguageIdentifier(languageId) {\n      if (!languageId || !this.isRegisteredLanguageId(languageId)) {\n        // Fall back to plain text if language is unknown\n        languageId = PLAINTEXT_LANGUAGE_ID;\n      }\n      if (!this._encounteredLanguages.has(languageId)) {\n        this._encounteredLanguages.add(languageId);\n        // Ensure tokenizers are created\n        TokenizationRegistry.getOrCreate(languageId);\n        // Fire event\n        this._onDidEncounterLanguage.fire(languageId);\n      }\n      return languageId;\n    }\n  }]);\n  return LanguageService;\n}(Disposable);\nLanguageService.instanceCount = 0;\nexport { LanguageService };\nvar LanguageSelection = /*#__PURE__*/function () {\n  function LanguageSelection(_onDidChangeLanguages, _selector) {\n    _classCallCheck(this, LanguageSelection);\n    this._onDidChangeLanguages = _onDidChangeLanguages;\n    this._selector = _selector;\n    this._listener = null;\n    this._emitter = null;\n    this.languageId = this._selector();\n  }\n  _createClass(LanguageSelection, [{\n    key: \"_dispose\",\n    value: function _dispose() {\n      if (this._listener) {\n        this._listener.dispose();\n        this._listener = null;\n      }\n      if (this._emitter) {\n        this._emitter.dispose();\n        this._emitter = null;\n      }\n    }\n  }, {\n    key: \"onDidChange\",\n    get: function get() {\n      var _this4 = this;\n      if (!this._listener) {\n        this._listener = this._onDidChangeLanguages(function () {\n          return _this4._evaluate();\n        });\n      }\n      if (!this._emitter) {\n        this._emitter = new Emitter({\n          onDidRemoveLastListener: function onDidRemoveLastListener() {\n            _this4._dispose();\n          }\n        });\n      }\n      return this._emitter.event;\n    }\n  }, {\n    key: \"_evaluate\",\n    value: function _evaluate() {\n      var _a;\n      var languageId = this._selector();\n      if (languageId === this.languageId) {\n        // no change\n        return;\n      }\n      this.languageId = languageId;\n      (_a = this._emitter) === null || _a === void 0 ? void 0 : _a.fire(this.languageId);\n    }\n  }]);\n  return LanguageSelection;\n}();","map":{"version":3,"names":["Emitter","Disposable","LanguagesRegistry","firstOrDefault","TokenizationRegistry","PLAINTEXT_LANGUAGE_ID","LanguageService","_Disposable","_inherits","_super","_createSuper","_this","warnOnOverwrite","arguments","length","undefined","_classCallCheck","call","_onDidEncounterLanguage","_register","onDidEncounterLanguage","event","_onDidChange","leakWarningThreshold","onDidChange","instanceCount","_encounteredLanguages","Set","_registry","languageIdCodec","fire","_createClass","key","value","dispose","_get","_getPrototypeOf","prototype","isRegisteredLanguageId","languageId","getLanguageIdByLanguageName","languageName","getLanguageIdByMimeType","mimeType","guessLanguageIdByFilepathOrFirstLine","resource","firstLine","languageIds","createById","_this2","LanguageSelection","_createAndGetLanguageIdentifier","createByFilepathOrFirstLine","_this3","has","add","getOrCreate","_onDidChangeLanguages","_selector","_listener","_emitter","_dispose","get","_this4","_evaluate","onDidRemoveLastListener","_a"],"sources":["/Users/cadany/WebstormProjects/monaco/node_modules/monaco-editor/esm/vs/editor/common/services/languageService.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { Emitter } from '../../../base/common/event.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { LanguagesRegistry } from './languagesRegistry.js';\nimport { firstOrDefault } from '../../../base/common/arrays.js';\nimport { TokenizationRegistry } from '../languages.js';\nimport { PLAINTEXT_LANGUAGE_ID } from '../languages/modesRegistry.js';\nclass LanguageService extends Disposable {\n    constructor(warnOnOverwrite = false) {\n        super();\n        this._onDidEncounterLanguage = this._register(new Emitter());\n        this.onDidEncounterLanguage = this._onDidEncounterLanguage.event;\n        this._onDidChange = this._register(new Emitter({ leakWarningThreshold: 200 /* https://github.com/microsoft/vscode/issues/119968 */ }));\n        this.onDidChange = this._onDidChange.event;\n        LanguageService.instanceCount++;\n        this._encounteredLanguages = new Set();\n        this._registry = this._register(new LanguagesRegistry(true, warnOnOverwrite));\n        this.languageIdCodec = this._registry.languageIdCodec;\n        this._register(this._registry.onDidChange(() => this._onDidChange.fire()));\n    }\n    dispose() {\n        LanguageService.instanceCount--;\n        super.dispose();\n    }\n    isRegisteredLanguageId(languageId) {\n        return this._registry.isRegisteredLanguageId(languageId);\n    }\n    getLanguageIdByLanguageName(languageName) {\n        return this._registry.getLanguageIdByLanguageName(languageName);\n    }\n    getLanguageIdByMimeType(mimeType) {\n        return this._registry.getLanguageIdByMimeType(mimeType);\n    }\n    guessLanguageIdByFilepathOrFirstLine(resource, firstLine) {\n        const languageIds = this._registry.guessLanguageIdByFilepathOrFirstLine(resource, firstLine);\n        return firstOrDefault(languageIds, null);\n    }\n    createById(languageId) {\n        return new LanguageSelection(this.onDidChange, () => {\n            return this._createAndGetLanguageIdentifier(languageId);\n        });\n    }\n    createByFilepathOrFirstLine(resource, firstLine) {\n        return new LanguageSelection(this.onDidChange, () => {\n            const languageId = this.guessLanguageIdByFilepathOrFirstLine(resource, firstLine);\n            return this._createAndGetLanguageIdentifier(languageId);\n        });\n    }\n    _createAndGetLanguageIdentifier(languageId) {\n        if (!languageId || !this.isRegisteredLanguageId(languageId)) {\n            // Fall back to plain text if language is unknown\n            languageId = PLAINTEXT_LANGUAGE_ID;\n        }\n        if (!this._encounteredLanguages.has(languageId)) {\n            this._encounteredLanguages.add(languageId);\n            // Ensure tokenizers are created\n            TokenizationRegistry.getOrCreate(languageId);\n            // Fire event\n            this._onDidEncounterLanguage.fire(languageId);\n        }\n        return languageId;\n    }\n}\nLanguageService.instanceCount = 0;\nexport { LanguageService };\nclass LanguageSelection {\n    constructor(_onDidChangeLanguages, _selector) {\n        this._onDidChangeLanguages = _onDidChangeLanguages;\n        this._selector = _selector;\n        this._listener = null;\n        this._emitter = null;\n        this.languageId = this._selector();\n    }\n    _dispose() {\n        if (this._listener) {\n            this._listener.dispose();\n            this._listener = null;\n        }\n        if (this._emitter) {\n            this._emitter.dispose();\n            this._emitter = null;\n        }\n    }\n    get onDidChange() {\n        if (!this._listener) {\n            this._listener = this._onDidChangeLanguages(() => this._evaluate());\n        }\n        if (!this._emitter) {\n            this._emitter = new Emitter({\n                onDidRemoveLastListener: () => {\n                    this._dispose();\n                }\n            });\n        }\n        return this._emitter.event;\n    }\n    _evaluate() {\n        var _a;\n        const languageId = this._selector();\n        if (languageId === this.languageId) {\n            // no change\n            return;\n        }\n        this.languageId = languageId;\n        (_a = this._emitter) === null || _a === void 0 ? void 0 : _a.fire(this.languageId);\n    }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}